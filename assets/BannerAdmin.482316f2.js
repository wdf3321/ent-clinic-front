import{Q as q}from"./QInput.11c8367d.js";import{Q as B}from"./QForm.435f2833.js";import{Q as O}from"./QCardSection.03f37f1a.js";import{b7 as A,y as p,z as g,A as i,b8 as S,b9 as D,ba as _,I as Q,bb as j,bc as M,v as N,x as I,r as w,f as d,B as f,Q as v,H as U,C as $,F as H,aY as b,b4 as R,aQ as E}from"./index.af45e0cf.js";import{Q as G,C as P}from"./ClosePopup.1e14ddd8.js";import{Q as Y}from"./QCard.a7811314.js";import{e as J,Q as K}from"./QTable.e9c99161.js";import{Q as W}from"./QImg.9c8ae809.js";import{u as X}from"./vue-i18n.runtime.esm-bundler.688671b0.js";import"./use-key-composition.78230714.js";import"./QCheckbox.2e19933a.js";let F=0;const Z={name:"VImageInput",emits:["update:modelValue","error:fileSize","error:fileType"],props:{modelValue:{type:[Object,String,null]},removable:{type:Boolean,required:!1,default:!1},maxFileSize:{type:Number,required:!1,default:10},acceptedTypes:{type:Array,required:!1,default:()=>["png","svg","jpg","jpeg"]}},data(){return F+=1,{uid:`image-input${F}`,isDragOver:!1,imgSrc:null}},computed:{acceptedTypesString(){return this.acceptedTypes.map(t=>`.${t}`).join(", ")}},watch:{modelValue:{immediate:!0,handler(t){if(!t||typeof this.modelValue=="string")this.imgSrc=t;else{const e=new FileReader;e.onload=n=>{this.imgSrc=n.target.result},e.readAsDataURL(t)}}}},methods:{isValidFileType(t){const e=t.name.toLowerCase().split("."),n=e[e.length-1];return this.acceptedTypes.map(s=>s.toLowerCase()).includes(n)},isValidFileSize(t){const e=t.size/1024/1024;return this.maxFileSize>e},handleFileDrop(t){const e=t.dataTransfer.files[0];if(!!e){if(!this.isValidFileType(e))return this.$emit("error:fileType");if(!this.isValidFileSize(e))return this.$emit("error:fileSize");this.$emit("update:modelValue",e),this.isDragOver=!1}},handleFileInput(t){const e=t.target.files[0];if(!!e){if(!this.isValidFileType(e))return this.$emit("error:fileType");if(!this.isValidFileSize(e))return this.$emit("error:fileSize");this.$emit("update:modelValue",e)}},removeImage(){this.$emit("update:modelValue",null)},onDragOver(){this.isDragOver=!0},onDragLeave(){this.isDragOver=!1}}},T=t=>(j("data-v-2b68f94a"),t=t(),M(),t),ee={key:0,class:"wrapper"},te=["for"],le=T(()=>i("svg",{class:"input-icon",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",fill:"currentColor",viewBox:"0 0 460.002 460.002","xml:space":"preserve"},[i("path",{d:`M427.137,0H32.865C14.743,0,0,14.743,0,32.865v408.543c0,10.253,8.341,18.594,18.594,18.594h408.543
            c18.122,0,32.865-14.743,32.865-32.865V32.865C460.002,14.743,445.259,0,427.137,0z M139.001,56.001c39.149,0,71,31.851,71,71
            s-31.851,71-71,71c-39.149,0-71-31.851-71-71C68.001,87.852,99.852,56.001,139.001,56.001z M405.24,393.215
            c-2.634,4.801-7.675,7.786-13.151,7.786H67.913c-5.477,0-10.518-2.984-13.151-7.786c-2.634-4.802-2.442-10.657,0.501-15.275
            l77.092-120.984c2.754-4.322,7.524-6.939,12.65-6.939s9.896,2.617,12.65,6.939l37.029,58.111l72.346-113.536
            c2.754-4.323,7.524-6.939,12.65-6.939c5.125,0,9.896,2.617,12.65,6.939L404.739,377.94
            C407.682,382.559,407.874,388.414,405.24,393.215z`})],-1)),ae={key:1,class:"wrapper"},ie=["for"],se=["src"],re=T(()=>i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",fill:"currentColor"},[i("path",{d:"M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"})],-1)),oe=["id","value","accept"];function ne(t,e,n,u,s,a){return p(),g("div",{class:"image-input",onDragleave:e[2]||(e[2]=(...r)=>a.onDragLeave&&a.onDragLeave(...r)),onDragover:e[3]||(e[3]=_((...r)=>a.onDragOver&&a.onDragOver(...r),["prevent"])),onDrop:e[4]||(e[4]=_((...r)=>a.handleFileDrop&&a.handleFileDrop(...r),["prevent"]))},[n.modelValue?(p(),g("div",ae,[i("label",{for:s.uid,class:D([{"is-drag-over":s.isDragOver},"input-label hover-label pointer"])},[i("img",{class:"selected-image",alt:"",src:s.imgSrc},null,8,se)],10,ie),n.removable?(p(),g("div",{key:0,onClick:e[0]||(e[0]=_((...r)=>a.removeImage&&a.removeImage(...r),["prevent"])),class:"remove-icon"},[S(t.$slots,"remove-icon",{},()=>[re],!0)])):Q("",!0)])):(p(),g("div",ee,[i("label",{for:s.uid,class:D(["input-label empty-layout",{"is-drag-over":s.isDragOver}])},[S(t.$slots,"empty-layout",{},()=>[le],!0)],10,te)])),i("input",{type:"file",class:"input",id:s.uid,value:n.modelValue?null:n.modelValue,onChange:e[1]||(e[1]=(...r)=>a.handleFileInput&&a.handleFileInput(...r)),accept:a.acceptedTypesString},null,40,oe)],32)}var z=A(Z,[["render",ne],["__scopeId","data-v-2b68f94a"]]);function V(t){V.installed||(V.installed=!0,t.component("VImageInput",z))}const de={install:V};let h=null;typeof window!="undefined"?h=window.Vue:typeof global!="undefined"&&(h=global.Vue);h&&h.use(de);const ue={class:"text-center"},ce={class:"q-pa-md text-center"},me={class:"text-center",id:"btns"},pe={class:"q-mt-md",id:"picpreview"},fe={class:"row justify-center"},De={__name:"BannerAdmin",setup(t){const{t:e}=X(),n=N(),u=I([]),s=w([]),a=w(!1),r=w(!1),m=I({id:"",image:void 0}),y=async()=>{const o=await b.get("/banner");console.log(o.data.result);let l=0;for(l=0;l<o.data.result.length;l++)u.push({_id:o.data.result[l]._id,id:o.data.result[l].id,image:o.data.result[l].image});n.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u53D6\u5F97\u6210\u529F"})};y();const x=async()=>{try{a.value=!0;const o=new FormData;o.append("image",m.image),o.append("id",m.id);const l=await b.post("/banner",o);for(console.log(l),n.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u4E0A\u50B3\u6210\u529F"}),a.value=!1,r.value=!1;u.length;)u.pop();y()}catch{n.notify({color:"red-4",textColor:"white",icon:"cloud_off",message:"\u4E0A\u50B3\u5931\u6557"}),a.value=!1}},k=async()=>{const o=await b.delete(`/banner/${s.value[0]._id}`);for(console.log(o),n.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u522A\u9664\u6210\u529F"});u.length;)u.pop();y()},L=[{name:"_id",align:"center",label:"_id",field:"_id",sortable:!0},{name:"id",align:"center",label:"id",field:"id",sortable:!0},{name:"image",label:e("image"),align:"center",field:"image",sortable:!0}];return(o,l)=>{var C;return p(),g(H,null,[i("div",ue,[d(J,{modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=c=>r.value=c),persistent:""},{default:f(()=>[d(Y,{style:{"min-width":"350px"}},{default:f(()=>[d(O,null,{default:f(()=>[d(B,{onSubmit:x,id:"upload"},{default:f(()=>[d(R(z),{modelValue:m.image,"onUpdate:modelValue":l[0]||(l[0]=c=>m.image=c),width:300,height:200},null,8,["modelValue"]),d(q,{outlined:"",modelValue:m.id,"onUpdate:modelValue":l[1]||(l[1]=c=>m.id=c),label:"\u7B2C\u5E7E\u5F35",class:"q-mt-xl"},null,8,["modelValue"])]),_:1})]),_:1}),d(G,{align:"right",class:"text-primary"},{default:f(()=>[E(d(v,{flat:"",label:"\u53D6\u6D88"},null,512),[[P]]),d(v,{type:"submit",icon:"upload",color:"teal",label:"\u4E0A\u50B3",onClick:x,loading:a.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),i("section",null,[i("div",ce,[d(K,{title:o.$t("banneradmin"),rows:u,columns:L,"row-key":"id",selection:"single",selected:s.value,"onUpdate:selected":l[3]||(l[3]=c=>s.value=c)},null,8,["title","rows","selected"])])]),i("section",null,[i("div",me,[d(v,{label:"\u65B0\u589E\u5716\u7247",icon:"add",color:"primary",onClick:l[4]||(l[4]=c=>r.value=!0),class:"q-mr-md-xl q-my-xs-xs"}),s.value[0]?(p(),U(v,{key:0,onClick:k,label:"\u522A\u9664\u5716\u7247",icon:"delete",color:"teal",class:"q-mr-md-xl q-my-xs-xs"})):Q("",!0)])]),i("div",pe,[i("div",fe,[$(" \u9810\u89BD: "),d(W,{src:(C=s.value[0])==null?void 0:C.image},null,8,["src"])])])],64)}}};export{De as default};
