import{Q as L}from"./QInput.d80e9bc5.js";import{b6 as k,v as m,x as p,y as d,b7 as x,b8 as C,b9 as _,a_ as B,ba as O,bb as q,aR as N,s as D,r as y,d as n,z as g,Q as f,D as A,F as M,aW as w,aZ as U,aN as j}from"./index.4fc50fb4.js";import{Q as R}from"./QForm.32e188c5.js";import{Q as H}from"./QCardSection.9d80e91f.js";import{Q as E}from"./QCard.9be33f9d.js";import{d as G,Q as P}from"./QTable.45c2df84.js";import{Q as W}from"./QImg.b6e56671.js";import{C as Z}from"./ClosePopup.9ce12936.js";import"./use-key-composition.66f2c17d.js";import"./QCheckbox.d43d84e2.js";let S=0;const $={name:"VImageInput",emits:["update:modelValue","error:fileSize","error:fileType"],props:{modelValue:{type:[Object,String,null]},removable:{type:Boolean,required:!1,default:!1},maxFileSize:{type:Number,required:!1,default:10},acceptedTypes:{type:Array,required:!1,default:()=>["png","svg","jpg","jpeg"]}},data(){return S+=1,{uid:`image-input${S}`,isDragOver:!1,imgSrc:null}},computed:{acceptedTypesString(){return this.acceptedTypes.map(l=>`.${l}`).join(", ")}},watch:{modelValue:{immediate:!0,handler(l){if(!l||typeof this.modelValue=="string")this.imgSrc=l;else{const e=new FileReader;e.onload=r=>{this.imgSrc=r.target.result},e.readAsDataURL(l)}}}},methods:{isValidFileType(l){const e=l.name.toLowerCase().split("."),r=e[e.length-1];return this.acceptedTypes.map(s=>s.toLowerCase()).includes(r)},isValidFileSize(l){const e=l.size/1024/1024;return this.maxFileSize>e},handleFileDrop(l){const e=l.dataTransfer.files[0];if(!!e){if(!this.isValidFileType(e))return this.$emit("error:fileType");if(!this.isValidFileSize(e))return this.$emit("error:fileSize");this.$emit("update:modelValue",e),this.isDragOver=!1}},handleFileInput(l){const e=l.target.files[0];if(!!e){if(!this.isValidFileType(e))return this.$emit("error:fileType");if(!this.isValidFileSize(e))return this.$emit("error:fileSize");this.$emit("update:modelValue",e)}},removeImage(){this.$emit("update:modelValue",null)},onDragOver(){this.isDragOver=!0},onDragLeave(){this.isDragOver=!1}}},I=l=>(O("data-v-2b68f94a"),l=l(),q(),l),J={key:0,class:"wrapper"},K=["for"],X=I(()=>d("svg",{class:"input-icon",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",fill:"currentColor",viewBox:"0 0 460.002 460.002","xml:space":"preserve"},[d("path",{d:`M427.137,0H32.865C14.743,0,0,14.743,0,32.865v408.543c0,10.253,8.341,18.594,18.594,18.594h408.543
            c18.122,0,32.865-14.743,32.865-32.865V32.865C460.002,14.743,445.259,0,427.137,0z M139.001,56.001c39.149,0,71,31.851,71,71
            s-31.851,71-71,71c-39.149,0-71-31.851-71-71C68.001,87.852,99.852,56.001,139.001,56.001z M405.24,393.215
            c-2.634,4.801-7.675,7.786-13.151,7.786H67.913c-5.477,0-10.518-2.984-13.151-7.786c-2.634-4.802-2.442-10.657,0.501-15.275
            l77.092-120.984c2.754-4.322,7.524-6.939,12.65-6.939s9.896,2.617,12.65,6.939l37.029,58.111l72.346-113.536
            c2.754-4.323,7.524-6.939,12.65-6.939c5.125,0,9.896,2.617,12.65,6.939L404.739,377.94
            C407.682,382.559,407.874,388.414,405.24,393.215z`})],-1)),Y={key:1,class:"wrapper"},ee=["for"],le=["src"],te=I(()=>d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",fill:"currentColor"},[d("path",{d:"M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"})],-1)),ae=["id","value","accept"];function ie(l,e,r,c,s,a){return m(),p("div",{class:"image-input",onDragleave:e[2]||(e[2]=(...i)=>a.onDragLeave&&a.onDragLeave(...i)),onDragover:e[3]||(e[3]=_((...i)=>a.onDragOver&&a.onDragOver(...i),["prevent"])),onDrop:e[4]||(e[4]=_((...i)=>a.handleFileDrop&&a.handleFileDrop(...i),["prevent"]))},[r.modelValue?(m(),p("div",Y,[d("label",{for:s.uid,class:C([{"is-drag-over":s.isDragOver},"input-label hover-label pointer"])},[d("img",{class:"selected-image",alt:"",src:s.imgSrc},null,8,le)],10,ee),r.removable?(m(),p("div",{key:0,onClick:e[0]||(e[0]=_((...i)=>a.removeImage&&a.removeImage(...i),["prevent"])),class:"remove-icon"},[x(l.$slots,"remove-icon",{},()=>[te],!0)])):B("",!0)])):(m(),p("div",J,[d("label",{for:s.uid,class:C(["input-label empty-layout",{"is-drag-over":s.isDragOver}])},[x(l.$slots,"empty-layout",{},()=>[X],!0)],10,K)])),d("input",{type:"file",class:"input",id:s.uid,value:r.modelValue?null:r.modelValue,onChange:e[1]||(e[1]=(...i)=>a.handleFileInput&&a.handleFileInput(...i)),accept:a.acceptedTypesString},null,40,ae)],32)}var F=k($,[["render",ie],["__scopeId","data-v-2b68f94a"]]);function b(l){b.installed||(b.installed=!0,l.component("VImageInput",F))}const re={install:b};let v=null;typeof window!="undefined"?v=window.Vue:typeof global!="undefined"&&(v=global.Vue);v&&v.use(re);const se={class:"text-center"},oe={class:"q-pa-md text-center"},ne={class:"q-mt-md",id:"pic"},ye={__name:"BannerAdmin",setup(l){const e=N(),r=D([]),c=y([]),s=y(!1),a=y(!1),i=D({id:"",image:void 0}),h=async()=>{const o=await w.get("/banner");console.log(o.data.result);let t=0;for(t=0;t<o.data.result.length;t++)r.push({_id:o.data.result[t]._id,id:o.data.result[t].id,image:o.data.result[t].image});e.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u53D6\u5F97\u6210\u529F"})};h();const T=async()=>{try{s.value=!0;const o=new FormData;o.append("image",i.image),o.append("id",i.id);const t=await w.post("/banner",o);for(console.log(t),e.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u4E0A\u50B3\u6210\u529F"}),s.value=!1,a.value=!1;r.length;)r.pop();h()}catch{e.notify({color:"red-4",textColor:"white",icon:"cloud_off",message:"\u4E0A\u50B3\u5931\u6557"}),s.value=!1}},z=async()=>{const o=await w.delete(`/banner/${c.value[0]._id}`);for(console.log(o),e.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u522A\u9664\u6210\u529F"});r.length;)r.pop();h()},Q=[{name:"_id",align:"center",label:"_id",field:"_id",sortable:!0},{name:"id",align:"center",label:"id",field:"id",sortable:!0},{name:"image",label:"image",align:"center",field:"image",sortable:!0}];return(o,t)=>{var V;return m(),p(M,null,[d("div",se,[n(G,{modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=u=>a.value=u),persistent:""},{default:g(()=>[n(E,{style:{"min-width":"350px"}},{default:g(()=>[n(H,null,{default:g(()=>[n(R,{onSubmit:T},{default:g(()=>[n(U(F),{modelValue:i.image,"onUpdate:modelValue":t[0]||(t[0]=u=>i.image=u),width:300,height:200},null,8,["modelValue"]),n(L,{outlined:"",modelValue:i.id,"onUpdate:modelValue":t[1]||(t[1]=u=>i.id=u),label:"\u7B2C\u5E7E\u5F35"},null,8,["modelValue"]),j(n(f,{flat:"",label:"\u53D6\u6D88"},null,512),[[Z]]),n(f,{type:"submit",icon:"upload",color:"teal",loading:s.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),d("section",null,[d("div",oe,[n(P,{title:"banner",rows:r,columns:Q,"row-key":"id",selection:"single",selected:c.value,"onUpdate:selected":t[3]||(t[3]=u=>c.value=u)},null,8,["rows","selected"]),n(f,{label:"\u65B0\u589E\u5716\u7247",icon:"add",color:"primary",onClick:t[4]||(t[4]=u=>a.value=!0),class:"q-mx-xl"}),n(f,{onClick:z,label:"\u522A\u9664\u5716\u7247",icon:"delete",color:"teal",class:"q-my-xl"})]),d("div",ne,[A(" \u9810\u89BD\uFF1B "),n(W,{src:(V=c.value[0])==null?void 0:V.image},null,8,["src"])])])],64)}}};export{ye as default};
