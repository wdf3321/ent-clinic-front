import{r as g,v as D,x as L,y as h,z as Y,A as f,f as n,B as c,b5 as _,Q as m,H as x,I as k,F as $,b6 as C,P as I,aS as Q,b4 as P}from"./index.ba11571a.js";import{Q as S,a as E}from"./QPopupProxy.c02443de.js";import{Q as M}from"./QInput.e8c8a3f3.js";import{Q as N,e as O}from"./QTable.e9170258.js";import{Q as z}from"./QCardSection.aa7c657f.js";import{Q as F,C as V}from"./ClosePopup.1051cf61.js";import{Q as H}from"./QCard.c5e9c110.js";import{u as G}from"./vue-i18n.runtime.esm-bundler.be40c759.js";import{h as B}from"./moment.9709ab41.js";import"./use-cache.b0833c75.js";import"./use-key-composition.3c2a0c73.js";import"./QCheckbox.5bb84311.js";function q(p){setTimeout(()=>{window.URL.revokeObjectURL(p.href)},1e4),p.remove()}function J(p,r,o={}){const{mimeType:d,byteOrderMark:i,encoding:y}=typeof o=="string"?{mimeType:o}:o,w=y!==void 0?new TextEncoder(y).encode([r]):r,u=i!==void 0?[i,w]:[w],v=new Blob(u,{type:d||"application/octet-stream"}),l=document.createElement("a");l.href=window.URL.createObjectURL(v),l.setAttribute("download",p),typeof l.download=="undefined"&&l.setAttribute("target","_blank"),l.classList.add("hidden"),l.style.position="fixed",document.body.appendChild(l);try{return l.click(),q(l),!0}catch(b){return q(l),b}}const K={class:"q-pa-md text-center"},W={class:"row items-center justify-end"},X={class:"row-xs column justify-center"},Z={class:"row justify-center"},ee=f("span",{class:"q-ml-sm"},"\u4F60\u78BA\u5B9A\u8981\u522A\u9664\uFF1F",-1),fe={__name:"ReserveAdmin",setup(p){const{t:r}=G(),o=g([]),d=D(),i=g(""),y=g("false"),w=g("id"),u=g("false"),v=[{name:"_id",required:!0,label:"_id",align:"left",field:e=>e.id,format:e=>`${e}`,sortable:!0},{name:"name",align:"center",label:r("name"),field:"name",sortable:!0},{name:"date",label:r("date"),field:"date",sortable:!0},{name:"time",label:r("time"),field:"time",sortable:!0},{name:"member",label:r("member"),field:"member",sortable:!0}],l=L([]),b=async()=>{const e=await C.get("/reserve/all");console.log(e.data.message),l.splice(0,l.length);let t=0;for(t=0;t<e.data.message.length;t++)B(e.data.message[t].date).isBefore(B().format("YYYY/MM/DD"))||(l.push({date:e.data.message[t].date,time:e.data.message[t].time,member:e.data.message[t].member,id:e.data.message[t]._id,name:e.data.message[t].name}),d.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u9810\u7D04\u53D6\u5F97\u6210\u529F"}))};b();function U(){b(),i.value="",y.value=!1,o.value=[]}const A=async()=>{try{console.log(o.value[0]);const e={id:o.value[0].id,time:o.value[0].time,date:o.value[0].date,member:o.value[0].member},t=await C.post("/reserve/cancel",e);for(console.log(t),d.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u9810\u7D04\u522A\u9664\u6210\u529F"});l.length;)l.pop();b()}catch(e){console.log(e),d.notify({color:"red-4",textColor:"white",icon:"cloud_done",message:"\u9810\u7D04\u522A\u9664\u5931\u6557"})}},R=async()=>{try{u.value=!0,l.splice(0,l.length);const e=await C.post("/reserve/cancelall");console.log(e),d.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u9810\u7D04\u522A\u9664\u6210\u529F"})}catch(e){console.log(e)}};function j(e,t,a){let s=t!==void 0?t(e,a):e;return s=s==null?"":String(s),s=s.split('"').join('""'),`"${s}"`}function T(){const e=[v.map(a=>j(a.label))].concat(l.map(a=>v.map(s=>j(typeof s.field=="function"?s.field(a):a[s.field===void 0?s.name:s.field],s.format,a)).join(","))).join(`\r
`);J("table-export.csv","\uFEFF"+e,"text/csv")!==!0&&d.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}return(e,t)=>(h(),Y($,null,[f("section",null,[f("div",K,[n(N,{title:e.$t("reserveadmin"),rows:l,columns:v,"row-key":w.value,selection:"single",selected:o.value,"onUpdate:selected":t[2]||(t[2]=a=>o.value=a),filter:i.value},{"top-right":c(()=>[n(M,{filled:"",modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=a=>i.value=a),mask:"date"},{append:c(()=>[n(I,{name:"calendar_today",class:"cursor-pointer"},{default:c(()=>[n(S,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:c(()=>[n(E,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=a=>i.value=a),"today-btn":""},{default:c(()=>[f("div",W,[Q(n(m,{label:"Close",color:"primary",flat:""},null,512),[[V]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["title","rows","row-key","selected","filter"])]),f("div",X,[n(m,{color:"primary",icon:"archive",label:_(r)("csv"),"no-caps":"",onClick:T,class:"q-mx-md"},null,8,["label"]),o.value[0]?(h(),x(m,{key:0,color:"teal",icon:"delete",onClick:A,label:_(r)("selectdelete"),class:"q-mx-md"},null,8,["label"])):k("",!0),o.value[0]?k("",!0):(h(),x(m,{key:1,color:"teal",icon:"delete",onClick:t[3]||(t[3]=a=>u.value=!0),label:_(r)("alldelete"),class:"q-mx-md"},null,8,["label"]))]),f("div",Z,[o.value[0]||i.value!==""?(h(),x(m,{key:0,icon:"reply",label:_(r)("back"),class:"q-mt-xl",onClick:U,color:"teal"},null,8,["label"])):k("",!0)])]),n(O,{modelValue:u.value,"onUpdate:modelValue":t[4]||(t[4]=a=>u.value=a),persistent:""},{default:c(()=>[n(H,{style:{"min-width":"200px"}},{default:c(()=>[n(z,{class:"row items-center justify-center"},{default:c(()=>[n(P,{icon:"help",color:"teal","text-color":"white"}),ee]),_:1}),n(F,{align:"center"},{default:c(()=>[Q(n(m,{flat:"",label:"Cancel",color:"primary"},null,512),[[V]]),Q(n(m,{flat:"",label:"Yes",color:"primary",onClick:R},null,512),[[V]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{fe as default};
