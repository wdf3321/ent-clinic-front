import{Q as L}from"./QInput.881edabe.js";import{b6 as k,v as m,x as p,y as r,b7 as x,b8 as C,b9 as _,a_ as B,ba as q,bb as O,aR as N,s as D,r as y,d,z as g,Q as f,D as A,F as M,aW as w,aZ as U,aN as j}from"./index.2d30cdb1.js";import{Q as R}from"./QForm.b8b4768f.js";import{Q as E}from"./QCardSection.b6c6119a.js";import{Q as H}from"./QCard.42f8513b.js";import{d as $,Q as G}from"./QTable.f1c13efc.js";import{Q as P}from"./QImg.0eb97724.js";import{C as W}from"./ClosePopup.bec7ab86.js";import"./use-key-composition.28b5ecc3.js";import"./QCheckbox.ac8f5c69.js";let S=0;const Z={name:"VImageInput",emits:["update:modelValue","error:fileSize","error:fileType"],props:{modelValue:{type:[Object,String,null]},removable:{type:Boolean,required:!1,default:!1},maxFileSize:{type:Number,required:!1,default:10},acceptedTypes:{type:Array,required:!1,default:()=>["png","svg","jpg","jpeg"]}},data(){return S+=1,{uid:`image-input${S}`,isDragOver:!1,imgSrc:null}},computed:{acceptedTypesString(){return this.acceptedTypes.map(t=>`.${t}`).join(", ")}},watch:{modelValue:{immediate:!0,handler(t){if(!t||typeof this.modelValue=="string")this.imgSrc=t;else{const e=new FileReader;e.onload=s=>{this.imgSrc=s.target.result},e.readAsDataURL(t)}}}},methods:{isValidFileType(t){const e=t.name.toLowerCase().split("."),s=e[e.length-1];return this.acceptedTypes.map(o=>o.toLowerCase()).includes(s)},isValidFileSize(t){const e=t.size/1024/1024;return this.maxFileSize>e},handleFileDrop(t){const e=t.dataTransfer.files[0];if(!!e){if(!this.isValidFileType(e))return this.$emit("error:fileType");if(!this.isValidFileSize(e))return this.$emit("error:fileSize");this.$emit("update:modelValue",e),this.isDragOver=!1}},handleFileInput(t){const e=t.target.files[0];if(!!e){if(!this.isValidFileType(e))return this.$emit("error:fileType");if(!this.isValidFileSize(e))return this.$emit("error:fileSize");this.$emit("update:modelValue",e)}},removeImage(){this.$emit("update:modelValue",null)},onDragOver(){this.isDragOver=!0},onDragLeave(){this.isDragOver=!1}}},I=t=>(q("data-v-2b68f94a"),t=t(),O(),t),J={key:0,class:"wrapper"},K=["for"],X=I(()=>r("svg",{class:"input-icon",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",fill:"currentColor",viewBox:"0 0 460.002 460.002","xml:space":"preserve"},[r("path",{d:`M427.137,0H32.865C14.743,0,0,14.743,0,32.865v408.543c0,10.253,8.341,18.594,18.594,18.594h408.543
            c18.122,0,32.865-14.743,32.865-32.865V32.865C460.002,14.743,445.259,0,427.137,0z M139.001,56.001c39.149,0,71,31.851,71,71
            s-31.851,71-71,71c-39.149,0-71-31.851-71-71C68.001,87.852,99.852,56.001,139.001,56.001z M405.24,393.215
            c-2.634,4.801-7.675,7.786-13.151,7.786H67.913c-5.477,0-10.518-2.984-13.151-7.786c-2.634-4.802-2.442-10.657,0.501-15.275
            l77.092-120.984c2.754-4.322,7.524-6.939,12.65-6.939s9.896,2.617,12.65,6.939l37.029,58.111l72.346-113.536
            c2.754-4.323,7.524-6.939,12.65-6.939c5.125,0,9.896,2.617,12.65,6.939L404.739,377.94
            C407.682,382.559,407.874,388.414,405.24,393.215z`})],-1)),Y={key:1,class:"wrapper"},ee=["for"],te=["src"],le=I(()=>r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",fill:"currentColor"},[r("path",{d:"M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"})],-1)),ae=["id","value","accept"];function ie(t,e,s,c,o,a){return m(),p("div",{class:"image-input",onDragleave:e[2]||(e[2]=(...i)=>a.onDragLeave&&a.onDragLeave(...i)),onDragover:e[3]||(e[3]=_((...i)=>a.onDragOver&&a.onDragOver(...i),["prevent"])),onDrop:e[4]||(e[4]=_((...i)=>a.handleFileDrop&&a.handleFileDrop(...i),["prevent"]))},[s.modelValue?(m(),p("div",Y,[r("label",{for:o.uid,class:C([{"is-drag-over":o.isDragOver},"input-label hover-label pointer"])},[r("img",{class:"selected-image",alt:"",src:o.imgSrc},null,8,te)],10,ee),s.removable?(m(),p("div",{key:0,onClick:e[0]||(e[0]=_((...i)=>a.removeImage&&a.removeImage(...i),["prevent"])),class:"remove-icon"},[x(t.$slots,"remove-icon",{},()=>[le],!0)])):B("",!0)])):(m(),p("div",J,[r("label",{for:o.uid,class:C(["input-label empty-layout",{"is-drag-over":o.isDragOver}])},[x(t.$slots,"empty-layout",{},()=>[X],!0)],10,K)])),r("input",{type:"file",class:"input",id:o.uid,value:s.modelValue?null:s.modelValue,onChange:e[1]||(e[1]=(...i)=>a.handleFileInput&&a.handleFileInput(...i)),accept:a.acceptedTypesString},null,40,ae)],32)}var F=k(Z,[["render",ie],["__scopeId","data-v-2b68f94a"]]);function b(t){b.installed||(b.installed=!0,t.component("VImageInput",F))}const se={install:b};let v=null;typeof window!="undefined"?v=window.Vue:typeof global!="undefined"&&(v=global.Vue);v&&v.use(se);const re={class:"text-center"},oe={class:"q-pa-md text-center"},ne={class:"text-center",id:"btns"},de={class:"q-mt-md",id:"pic"},we={__name:"BannerAdmin",setup(t){const e=N(),s=D([]),c=y([]),o=y(!1),a=y(!1),i=D({id:"",image:void 0}),h=async()=>{const n=await w.get("/banner");console.log(n.data.result);let l=0;for(l=0;l<n.data.result.length;l++)s.push({_id:n.data.result[l]._id,id:n.data.result[l].id,image:n.data.result[l].image});e.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u53D6\u5F97\u6210\u529F"})};h();const T=async()=>{try{o.value=!0;const n=new FormData;n.append("image",i.image),n.append("id",i.id);const l=await w.post("/banner",n);for(console.log(l),e.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u4E0A\u50B3\u6210\u529F"}),o.value=!1,a.value=!1;s.length;)s.pop();h()}catch{e.notify({color:"red-4",textColor:"white",icon:"cloud_off",message:"\u4E0A\u50B3\u5931\u6557"}),o.value=!1}},z=async()=>{const n=await w.delete(`/banner/${c.value[0]._id}`);for(console.log(n),e.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u522A\u9664\u6210\u529F"});s.length;)s.pop();h()},Q=[{name:"_id",align:"center",label:"_id",field:"_id",sortable:!0},{name:"id",align:"center",label:"id",field:"id",sortable:!0},{name:"image",label:"image",align:"center",field:"image",sortable:!0}];return(n,l)=>{var V;return m(),p(M,null,[r("div",re,[d($,{modelValue:a.value,"onUpdate:modelValue":l[2]||(l[2]=u=>a.value=u),persistent:""},{default:g(()=>[d(H,{style:{"min-width":"350px"}},{default:g(()=>[d(E,null,{default:g(()=>[d(R,{onSubmit:T},{default:g(()=>[d(U(F),{modelValue:i.image,"onUpdate:modelValue":l[0]||(l[0]=u=>i.image=u),width:300,height:200},null,8,["modelValue"]),d(L,{outlined:"",modelValue:i.id,"onUpdate:modelValue":l[1]||(l[1]=u=>i.id=u),label:"\u7B2C\u5E7E\u5F35"},null,8,["modelValue"]),j(d(f,{flat:"",label:"\u53D6\u6D88"},null,512),[[W]]),d(f,{type:"submit",icon:"upload",color:"teal",loading:o.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),r("section",null,[r("div",oe,[d(G,{title:"BANNER",rows:s,columns:Q,"row-key":"id",selection:"single",selected:c.value,"onUpdate:selected":l[3]||(l[3]=u=>c.value=u)},null,8,["rows","selected"])])]),r("section",null,[r("div",ne,[d(f,{label:"\u65B0\u589E\u5716\u7247",icon:"add",color:"primary",onClick:l[4]||(l[4]=u=>a.value=!0),class:"q-mr-md-xl q-my-xs-xs"}),d(f,{onClick:z,label:"\u522A\u9664\u5716\u7247",icon:"delete",color:"teal",class:"q-mr-md-xl q-my-xs-xs"})])]),r("div",de,[A(" \u9810\u89BD\uFF1B "),d(P,{src:(V=c.value[0])==null?void 0:V.image},null,8,["src"])])],64)}}};export{we as default};
