import{r as g,aR as D,s as T,t as h,v as L,x as f,f as l,y as i,Q as m,D as Q,E as V,F as Y,aW as _,M as $,aN as x,aV as E}from"./index.8af24e4f.js";import{Q as M,a as N}from"./QPopupProxy.de4f561b.js";import{Q as I}from"./QInput.d8b0c0f5.js";import{Q as O,e as P}from"./QTable.fdf33908.js";import{Q as S}from"./QCardSection.3c338591.js";import{Q as F,C}from"./ClosePopup.ee745384.js";import{Q as z}from"./QCard.ea252f2e.js";import{u as W}from"./vue-i18n.runtime.esm-bundler.afff78d9.js";import{h as j}from"./moment.9709ab41.js";import"./use-cache.b0833c75.js";import"./use-key-composition.982b5102.js";import"./QCheckbox.75921a51.js";function q(p){setTimeout(()=>{window.URL.revokeObjectURL(p.href)},1e4),p.remove()}function G(p,c,s={}){const{mimeType:d,byteOrderMark:r,encoding:y}=typeof s=="string"?{mimeType:s}:s,w=y!==void 0?new TextEncoder(y).encode([c]):c,u=r!==void 0?[r,w]:[w],v=new Blob(u,{type:d||"application/octet-stream"}),o=document.createElement("a");o.href=window.URL.createObjectURL(v),o.setAttribute("download",p),typeof o.download=="undefined"&&o.setAttribute("target","_blank"),o.classList.add("hidden"),o.style.position="fixed",document.body.appendChild(o);try{return o.click(),q(o),!0}catch(b){return q(o),b}}const H={class:"q-pa-md text-center"},J={class:"row items-center justify-end"},K={class:"row-xs column justify-center"},X={class:"row justify-center"},Z=f("span",{class:"q-ml-sm"},"\u4F60\u78BA\u5B9A\u8981\u522A\u9664\uFF1F",-1),ue={__name:"ReserveAdmin",setup(p){const{t:c}=W(),s=g([]),d=D(),r=g(""),y=g("false"),w=g("id"),u=g("false"),v=[{name:"_id",required:!0,label:"_id",align:"left",field:e=>e.id,format:e=>`${e}`,sortable:!0},{name:"name",align:"center",label:c("name"),field:"name",sortable:!0},{name:"date",label:c("date"),field:"date",sortable:!0},{name:"time",label:c("time"),field:"time",sortable:!0},{name:"member",label:c("member"),field:"member",sortable:!0}],o=T([]),b=async()=>{const e=await _.get("/reserve/all");console.log(e.data.message),o.splice(0,o.length);let t=0;for(t=0;t<e.data.message.length;t++)j(e.data.message[t].date).isBefore(j().format("YYYY/MM/DD"))||(o.push({date:e.data.message[t].date,time:e.data.message[t].time,member:e.data.message[t].member,id:e.data.message[t]._id,name:e.data.message[t].name}),d.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u9810\u7D04\u53D6\u5F97\u6210\u529F"}))};b();function B(){b(),r.value="",y.value=!1,s.value=[]}const U=async()=>{try{console.log(s.value[0]);const e={id:s.value[0].id,time:s.value[0].time,date:s.value[0].date,member:s.value[0].member},t=await _.post("/reserve/cancel",e);for(console.log(t),d.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u9810\u7D04\u522A\u9664\u6210\u529F"});o.length;)o.pop();b()}catch(e){console.log(e),d.notify({color:"red-4",textColor:"white",icon:"cloud_done",message:"\u9810\u7D04\u522A\u9664\u5931\u6557"})}},R=async()=>{try{u.value=!0,o.splice(0,o.length);const e=await _.post("/reserve/cancelall");console.log(e),d.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u9810\u7D04\u522A\u9664\u6210\u529F"})}catch(e){console.log(e)}};function k(e,t,a){let n=t!==void 0?t(e,a):e;return n=n==null?"":String(n),n=n.split('"').join('""'),`"${n}"`}function A(){const e=[v.map(a=>k(a.label))].concat(o.map(a=>v.map(n=>k(typeof n.field=="function"?n.field(a):a[n.field===void 0?n.name:n.field],n.format,a)).join(","))).join(`\r
`);G("table-export.csv","\uFEFF"+e,"text/csv")!==!0&&d.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}return(e,t)=>(h(),L(Y,null,[f("section",null,[f("div",H,[l(O,{title:e.$t("reserveadmin"),rows:o,columns:v,"row-key":w.value,selection:"single",selected:s.value,"onUpdate:selected":t[2]||(t[2]=a=>s.value=a),filter:r.value},{"top-right":i(()=>[l(I,{filled:"",modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=a=>r.value=a),mask:"date"},{append:i(()=>[l($,{name:"calendar_today",class:"cursor-pointer"},{default:i(()=>[l(M,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[l(N,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),"today-btn":""},{default:i(()=>[f("div",J,[x(l(m,{label:"Close",color:"primary",flat:""},null,512),[[C]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["title","rows","row-key","selected","filter"])]),f("div",K,[l(m,{color:"primary",icon:"archive",label:"\u7522\u751Fcsv","no-caps":"",onClick:A,class:"q-mx-md"}),s.value[0]?(h(),Q(m,{key:0,color:"teal",icon:"delete",onClick:U,label:"\u522A\u9664\u9078\u64C7",class:"q-mx-md"})):V("",!0),s.value[0]?V("",!0):(h(),Q(m,{key:1,color:"teal",icon:"delete",onClick:t[3]||(t[3]=a=>u.value=!0),label:"\u4E00\u9375\u5168\u522A",class:"q-mx-md"}))]),f("div",X,[l(m,{icon:"reply",label:"\u8FD4\u56DE",class:"q-mt-xl",onClick:B,color:"teal"})])]),l(P,{modelValue:u.value,"onUpdate:modelValue":t[4]||(t[4]=a=>u.value=a),persistent:""},{default:i(()=>[l(z,{style:{"min-width":"200px"}},{default:i(()=>[l(S,{class:"row items-center justify-center"},{default:i(()=>[l(E,{icon:"help",color:"teal","text-color":"white"}),Z]),_:1}),l(F,{align:"center"},{default:i(()=>[x(l(m,{flat:"",label:"Cancel",color:"primary"},null,512),[[C]]),x(l(m,{flat:"",label:"Yes",color:"primary",onClick:R},null,512),[[C]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{ue as default};
