import{Q}from"./QInput.18c0e410.js";import{b6 as L,v as m,x as p,y as n,b7 as V,b8 as x,b9 as _,a_ as k,ba as B,bb as O,aR as q,s as C,r as y,d as o,z as g,Q as f,D as N,F as A,aW as h,aZ as M,aN as U}from"./index.32e86c97.js";import{Q as j}from"./QForm.8851f665.js";import{Q as R}from"./QCardSection.6414492d.js";import{Q as H}from"./QCard.416feacd.js";import{d as E,Q as G}from"./QTable.ac05c9e3.js";import{Q as P}from"./QImg.789591b7.js";import{C as W}from"./ClosePopup.5ba4374b.js";import"./use-key-composition.83f6cb12.js";import"./QCheckbox.13b6b603.js";let D=0;const Z={name:"VImageInput",emits:["update:modelValue","error:fileSize","error:fileType"],props:{modelValue:{type:[Object,String,null]},removable:{type:Boolean,required:!1,default:!1},maxFileSize:{type:Number,required:!1,default:10},acceptedTypes:{type:Array,required:!1,default:()=>["png","svg","jpg","jpeg"]}},data(){return D+=1,{uid:`image-input${D}`,isDragOver:!1,imgSrc:null}},computed:{acceptedTypesString(){return this.acceptedTypes.map(l=>`.${l}`).join(", ")}},watch:{modelValue:{immediate:!0,handler(l){if(!l||typeof this.modelValue=="string")this.imgSrc=l;else{const e=new FileReader;e.onload=d=>{this.imgSrc=d.target.result},e.readAsDataURL(l)}}}},methods:{isValidFileType(l){const e=l.name.toLowerCase().split("."),d=e[e.length-1];return this.acceptedTypes.map(r=>r.toLowerCase()).includes(d)},isValidFileSize(l){const e=l.size/1024/1024;return this.maxFileSize>e},handleFileDrop(l){const e=l.dataTransfer.files[0];if(!!e){if(!this.isValidFileType(e))return this.$emit("error:fileType");if(!this.isValidFileSize(e))return this.$emit("error:fileSize");this.$emit("update:modelValue",e),this.isDragOver=!1}},handleFileInput(l){const e=l.target.files[0];if(!!e){if(!this.isValidFileType(e))return this.$emit("error:fileType");if(!this.isValidFileSize(e))return this.$emit("error:fileSize");this.$emit("update:modelValue",e)}},removeImage(){this.$emit("update:modelValue",null)},onDragOver(){this.isDragOver=!0},onDragLeave(){this.isDragOver=!1}}},S=l=>(B("data-v-2b68f94a"),l=l(),O(),l),$={key:0,class:"wrapper"},J=["for"],K=S(()=>n("svg",{class:"input-icon",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",fill:"currentColor",viewBox:"0 0 460.002 460.002","xml:space":"preserve"},[n("path",{d:`M427.137,0H32.865C14.743,0,0,14.743,0,32.865v408.543c0,10.253,8.341,18.594,18.594,18.594h408.543
            c18.122,0,32.865-14.743,32.865-32.865V32.865C460.002,14.743,445.259,0,427.137,0z M139.001,56.001c39.149,0,71,31.851,71,71
            s-31.851,71-71,71c-39.149,0-71-31.851-71-71C68.001,87.852,99.852,56.001,139.001,56.001z M405.24,393.215
            c-2.634,4.801-7.675,7.786-13.151,7.786H67.913c-5.477,0-10.518-2.984-13.151-7.786c-2.634-4.802-2.442-10.657,0.501-15.275
            l77.092-120.984c2.754-4.322,7.524-6.939,12.65-6.939s9.896,2.617,12.65,6.939l37.029,58.111l72.346-113.536
            c2.754-4.323,7.524-6.939,12.65-6.939c5.125,0,9.896,2.617,12.65,6.939L404.739,377.94
            C407.682,382.559,407.874,388.414,405.24,393.215z`})],-1)),X={key:1,class:"wrapper"},Y=["for"],ee=["src"],le=S(()=>n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",fill:"currentColor"},[n("path",{d:"M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"})],-1)),te=["id","value","accept"];function ae(l,e,d,c,r,a){return m(),p("div",{class:"image-input",onDragleave:e[2]||(e[2]=(...i)=>a.onDragLeave&&a.onDragLeave(...i)),onDragover:e[3]||(e[3]=_((...i)=>a.onDragOver&&a.onDragOver(...i),["prevent"])),onDrop:e[4]||(e[4]=_((...i)=>a.handleFileDrop&&a.handleFileDrop(...i),["prevent"]))},[d.modelValue?(m(),p("div",X,[n("label",{for:r.uid,class:x([{"is-drag-over":r.isDragOver},"input-label hover-label pointer"])},[n("img",{class:"selected-image",alt:"",src:r.imgSrc},null,8,ee)],10,Y),d.removable?(m(),p("div",{key:0,onClick:e[0]||(e[0]=_((...i)=>a.removeImage&&a.removeImage(...i),["prevent"])),class:"remove-icon"},[V(l.$slots,"remove-icon",{},()=>[le],!0)])):k("",!0)])):(m(),p("div",$,[n("label",{for:r.uid,class:x(["input-label empty-layout",{"is-drag-over":r.isDragOver}])},[V(l.$slots,"empty-layout",{},()=>[K],!0)],10,J)])),n("input",{type:"file",class:"input",id:r.uid,value:d.modelValue?null:d.modelValue,onChange:e[1]||(e[1]=(...i)=>a.handleFileInput&&a.handleFileInput(...i)),accept:a.acceptedTypesString},null,40,te)],32)}var I=L(Z,[["render",ae],["__scopeId","data-v-2b68f94a"]]);function w(l){w.installed||(w.installed=!0,l.component("VImageInput",I))}const ie={install:w};let v=null;typeof window!="undefined"?v=window.Vue:typeof global!="undefined"&&(v=global.Vue);v&&v.use(ie);const re={class:"text-center"},se={class:"q-pa-md text-center"},oe={class:"q-mt-md",id:"pic"},he={__name:"BannerAdmin",setup(l){const e=q(),d=C([]),c=y([]),r=y(!1),a=y(!1),i=C({id:"",image:void 0});(async()=>{const s=await h.get("/banner");console.log(s.data.result);let t=0;for(t=0;t<s.data.result.length;t++)d.push({_id:s.data.result[t]._id,id:s.data.result[t].id,image:s.data.result[t].image});e.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u53D6\u5F97\u6210\u529F"})})();const F=async()=>{try{r.value=!0;const s=new FormData;s.append("image",i.image),s.append("id",i.id);const t=await h.post("/banner",s);console.log(t),e.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u4E0A\u50B3\u6210\u529F"}),r.value=!1,a.value=!1}catch{e.notify({color:"red-4",textColor:"white",icon:"cloud_off",message:"\u4E0A\u50B3\u5931\u6557"}),r.value=!1}},T=async()=>{const s=await h.delete(`/banner/${c.value[0]._id}`);console.log(s),e.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"\u522A\u9664\u6210\u529F"})},z=[{name:"_id",align:"center",label:"_id",field:"_id",sortable:!0},{name:"id",align:"center",label:"id",field:"id",sortable:!0},{name:"image",label:"image",align:"center",field:"image",sortable:!0}];return(s,t)=>{var b;return m(),p(A,null,[n("div",re,[o(E,{modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=u=>a.value=u),persistent:""},{default:g(()=>[o(H,{style:{"min-width":"350px"}},{default:g(()=>[o(R,null,{default:g(()=>[o(j,{onSubmit:F},{default:g(()=>[o(M(I),{modelValue:i.image,"onUpdate:modelValue":t[0]||(t[0]=u=>i.image=u),width:300,height:200},null,8,["modelValue"]),o(Q,{outlined:"",modelValue:i.id,"onUpdate:modelValue":t[1]||(t[1]=u=>i.id=u),label:"\u7B2C\u5E7E\u5F35"},null,8,["modelValue"]),U(o(f,{flat:"",label:"\u53D6\u6D88"},null,512),[[W]]),o(f,{type:"submit",icon:"upload",color:"teal",loading:r.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),n("section",null,[n("div",se,[o(G,{title:"banner",rows:d,columns:z,"row-key":"id",selection:"single",selected:c.value,"onUpdate:selected":t[3]||(t[3]=u=>c.value=u)},null,8,["rows","selected"]),o(f,{label:"\u65B0\u589E\u5716\u7247",icon:"add",color:"primary",onClick:t[4]||(t[4]=u=>a.value=!0),class:"q-mx-xl"}),o(f,{onClick:T,label:"\u522A\u9664\u5716\u7247",icon:"delete",color:"teal",class:"q-my-xl"})]),n("div",oe,[N(" \u9810\u89BD\uFF1B "),o(P,{src:(b=c.value[0])==null?void 0:b.image},null,8,["src"])])])],64)}}};export{he as default};
